Thanks for the updated file â€” this confirms the root cause. âœ…
Here is the key detail:

Your **`capabilities.json`** defines a property called:

> `"bookmarkResetTrigger"` under `"panelSettings"`
> *(a bool property used to represent UI state)*
>

---

## âœ… Why Bookmark Reset Still Does NOT Work

Bookmarks in Power BI **only** store and restore:

| Tracked by Bookmark                   | Not Tracked by Bookmark                                   |
| ------------------------------------- | --------------------------------------------------------- |
| Filters applied via `applyJsonFilter` | Any internal UI state                                     |
| Slicer state                          | Visual custom properties not tied to data model           |
| Selection filters from other visuals  | Custom filter logic that doesnâ€™t modify PBIX Filter Model |

Right now, your custom visual:

âœ… Toggles UI selections
âœ… Stores internal selections in `settings.ts` / memory
âŒ Does **NOT** push state into Power BI Filter Model
âŒ Does **NOT** reload state from Filter Model when bookmark restores

So when the bookmark reset button is pressed:

> Visual resets what Power BI knows
> Your custom filter keeps its own state â†’ not touched

---

## ðŸ” Most critical missing pieces in your custom visual

To support bookmark reset, your visual **must**:

### 1ï¸âƒ£ Apply filters using Power BI Filter API

(so bookmarks know the â€œfilter stateâ€ exists)

```ts
this.host.applyJsonFilter(
    filter,
    "tableName",
    "columnName",
    powerbi.FilterAction.merge
);
```

Right now, your filter UI is **not** calling this.

---

### 2ï¸âƒ£ Store selections in `visual.update(options)` based on restored filters

Power BI calls update() when a bookmark is restored â€”
if you read the filter model here, you can **rebuild selection UI**.

This is missing â†’ so UI stays â€œdirty.â€

---

### 3ï¸âƒ£ Use `BookmarkResetTrigger` only as **UI-switch**, not state reset**

You defined the property, but:

âœ… It appears in Format Pane
âŒ It does NOT clear the internal selection model
âŒ It does NOT interact with bookmarks

So Power BI toggles the flagâ€¦ but your visual **ignores it** when updating.

---

## âœ… To Fix Bookmark Reset

You need to implement:

| Fix                                             | Location in Code           | Status    |
| ----------------------------------------------- | -------------------------- | --------- |
| Apply filters via host.applyJsonFilter          | filterManager.ts           | âŒ missing |
| Deserialize filters in visual.update()          | visual.ts                  | âŒ missing |
| Clear local UI state when filter model is empty | uiManager.ts / settings.ts | âŒ missing |

---

### âœ… Minimum Insert To Detect Bookmark Reset

Inside `visual.update(options)`, detect that all external filters are wiped:

```ts
const hasFilters =
    options.jsonFilters && options.jsonFilters.length > 0;

if (!hasFilters) {
    this.settings.clearSelections();  // âœ… your custom method required
    this.ui.reset();                  // âœ… re-render UI clean
}
```

This ensures the UI **resets** when bookmark resets filters.

---

## âœ… Summary (Simple & Direct)

> Right now your custom visual only filters inside itself.
> Power BI bookmarks only reset what Power BI tracks.
> Therefore your filter visual keeps selections when bookmarks reset.

Fix = Sync your visual state with PBIX Filter Model!

---

